{% extends 'core/admin/base.html' %}

{% block title %}Head Office Dashboard{% endblock %}

{% block content %}

<div class="p-6 bg-gray-100 min-h-screen relative">

  <!-- Notification Bell -->
  <div class="absolute top-6 right-6 group">
    <a href="#" class="relative inline-block">
      <!-- Bell Icon -->
      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-800" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
      </svg>

      <!-- Unread Badge -->
      {% if unread_messages_count > 0 %}
      <span class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold text-white bg-red-600 rounded-full">
        {{ unread_messages_count }}
      </span>
      {% endif %}
    </a>

    {% if new_replies_count > 0 %}
<span class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold text-white bg-red-600 rounded-full">
  {{ new_replies_count }}
</span>
{% endif %}


    <!-- Dropdown Messages Preview -->
    <div class="absolute right-0 mt-2 w-80 bg-white border border-gray-200 rounded-lg shadow-lg z-50 hidden group-hover:block">
      <div class="p-3 font-bold text-gray-700 border-b">Recent Messages</div>
      <ul class="max-h-60 overflow-y-auto">
        {% for msg in request.user.received_messages.all|dictsortreversed:"created_at"|slice:":5" %}
        <li class="p-2 border-b hover:bg-gray-100">
          <p class="font-semibold text-gray-800">From: {{ msg.sender.username }}</p>
          <p class="text-gray-600 truncate">{{ msg.message }}</p>
          {% if msg.reply %}
          <p class="text-green-600 truncate">Reply: {{ msg.reply }}</p>
          {% endif %}
        </li>
        {% empty %}
        <li class="p-2 text-gray-500">No messages</li>
        {% endfor %}
      </ul>
      <div class="p-2 text-center border-t">
        <a href="{% url 'send_admin_message' %}" class="text-blue-600 font-semibold hover:underline">View All</a>
      </div>
    </div>
  </div>

  <!-- Header -->
  <h2 class="text-3xl font-extrabold text-center text-gray-800 uppercase mb-10">
    Head Office <span class="text-yellow-500">(Admin)</span> Dashboard
  </h2>

  <!-- Member Statistics Section -->
  <section class="mb-12">
    <h3 class="text-2xl font-semibold text-center text-yellow-500 uppercase mb-8">Member Statistics</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">

      <!-- State Members -->
      <div class="bg-gradient-to-tr from-blue-100 via-white to-blue-50 shadow-lg rounded-2xl p-6 border-l-4 border-blue-500 hover:scale-105 transform transition duration-300">
        <h4 class="text-lg font-bold mb-4 text-gray-800 border-b border-gray-200 pb-2">State Members</h4>
        <p class="flex justify-between text-gray-600 font-semibold"><span>Total</span> <span class="text-blue-600 font-bold">{{ state_member_count }}</span></p>
        <p class="flex justify-between text-gray-600 font-semibold"><span>Active</span> <span class="text-green-500 font-bold">{{ state_member_active_count }}</span></p>
        <p class="flex justify-between text-gray-600 font-semibold"><span>Inactive</span> <span class="text-red-500 font-bold">{{ state_member_inactive_count }}</span></p>
      </div>

      <!-- District Members -->
      <div class="bg-gradient-to-tr from-green-100 via-white to-green-50 shadow-lg rounded-2xl p-6 border-l-4 border-green-500 hover:scale-105 transform transition duration-300">
        <h4 class="text-lg font-bold mb-4 text-gray-800 border-b border-gray-200 pb-2">District Members</h4>
        <p class="flex justify-between text-gray-600 font-semibold"><span>Total</span> <span class="text-blue-600 font-bold">{{ district_member_count }}</span></p>
        <p class="flex justify-between text-gray-600 font-semibold"><span>Active</span> <span class="text-green-500 font-bold">{{ district_member_active_count }}</span></p>
        <p class="flex justify-between text-gray-600 font-semibold"><span>Inactive</span> <span class="text-red-500 font-bold">{{ district_member_inactive_count }}</span></p>
      </div>

      <!-- Block Members -->
      <div class="bg-gradient-to-tr from-yellow-100 via-white to-yellow-50 shadow-lg rounded-2xl p-6 border-l-4 border-yellow-500 hover:scale-105 transform transition duration-300">
        <h4 class="text-lg font-bold mb-4 text-gray-800 border-b border-gray-200 pb-2">Block Members</h4>
        <p class="flex justify-between text-gray-600 font-semibold"><span>Total</span> <span class="text-blue-600 font-bold">{{ block_member_count }}</span></p>
        <p class="flex justify-between text-gray-600 font-semibold"><span>Active</span> <span class="text-green-500 font-bold">{{ block_member_active_count }}</span></p>
        <p class="flex justify-between text-gray-600 font-semibold"><span>Inactive</span> <span class="text-red-500 font-bold">{{ block_member_inactive_count }}</span></p>
      </div>

      <!-- Booth Members -->
      <div class="bg-gradient-to-tr from-purple-100 via-white to-purple-50 shadow-lg rounded-2xl p-6 border-l-4 border-purple-500 hover:scale-105 transform transition duration-300">
        <h4 class="text-lg font-bold mb-4 text-gray-800 border-b border-gray-200 pb-2">Booth Members</h4>
        <p class="flex justify-between text-gray-600 font-semibold"><span>Total</span> <span class="text-blue-600 font-bold">{{ booth_member_count }}</span></p>
        <p class="flex justify-between text-gray-600 font-semibold"><span>Active</span> <span class="text-green-500 font-bold">{{ booth_member_active_count }}</span></p>
        <p class="flex justify-between text-gray-600 font-semibold"><span>Inactive</span> <span class="text-red-500 font-bold">{{ booth_member_inactive_count }}</span></p>
      </div>

    </div>
  </section>

  

  <!-- Complaint Breakdown -->
<section class="mt-16 px-4">
  <h3 class="text-3xl font-bold text-center text-yellow-600 tracking-wide mb-10">
    Complaint Breakdown <span class="text-gray-500 text-lg">(State → District → Block → Panchayat)</span>
  </h3>

  <div class="grid grid-cols-1 gap-8 md:grid-cols-2">

    <!-- State Complaints -->
<div class="bg-white shadow-xl rounded-2xl p-6 border border-gray-200 hover:shadow-2xl transition transform hover:scale-105 overflow-x-auto">
  <h4 class="text-lg font-bold mb-4 text-gray-800 border-b border-gray-200 pb-2 flex items-center gap-2">
    <i class="fas fa-flag text-blue-500"></i> State Complaints
  </h4>
  <table class="w-full min-w-[400px] border border-gray-200 rounded-lg">
    <thead>
      <tr class="bg-blue-50 text-gray-700 text-sm uppercase">
        <th class="p-2 text-left border">State</th>
        <th class="p-2 text-left border">Total</th>
        <th class="p-2 text-left border">Accepted</th>
        <th class="p-2 text-left border">Rejected</th>
        <th class="p-2 text-left border">Solved</th>
      </tr>
    </thead>
    <tbody class="text-gray-600 text-sm">
      {% for item in state_complaints %}
      <tr class="hover:bg-blue-50 transition">
        <td class="p-2 border font-medium">{{ item.state }}</td>
        <td class="p-2 border font-bold text-blue-600">{{ item.total }}</td>
        <td class="p-2 border font-bold text-green-600">{{ item.accepted }}</td>
        <td class="p-2 border font-bold text-red-600">{{ item.rejected }}</td>
        <td class="p-2 border font-bold text-purple-600">{{ item.solved }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="p-2 text-center text-gray-500">No Data</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>


    <!-- District Wise -->
    <div class="bg-white shadow-xl rounded-2xl p-6 border border-gray-200 hover:shadow-2xl transition transform hover:scale-105 overflow-x-auto">
      <h4 class="text-lg font-semibold text-gray-700 mb-5 flex items-center gap-2">
        <i class="fas fa-map-marker-alt text-red-500"></i> District Wise Complaints
      </h4>
      <table class="w-full min-w-[400px] border border-gray-200 rounded-lg">
        <thead>
          <tr class="bg-yellow-50 text-gray-700 text-sm uppercase">
            <th class="p-2 text-left border">District</th>
            <th class="p-2 text-left border">Total</th>
            <th class="p-2 text-left border">Accepted</th>
            <th class="p-2 text-left border">Rejected</th>
            <th class="p-2 text-left border">Solved</th>
          </tr>
        </thead>
        <tbody class="text-gray-600 text-sm">
          {% for item in district_wise_complaints %}
          <tr class="hover:bg-yellow-50 transition">
            <td class="p-2 border font-medium">{{ item.district }}</td>
            <td class="p-2 border font-bold text-blue-600">{{ item.total }}</td>
            <td class="p-2 border font-bold text-green-600">{{ item.accepted }}</td>
            <td class="p-2 border font-bold text-red-600">{{ item.rejected }}</td>
            <td class="p-2 border font-bold text-purple-600">{{ item.solved }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="5" class="p-2 text-center text-gray-500">No Data</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Block Wise -->
    <div class="bg-white shadow-xl rounded-2xl p-6 border border-gray-200 hover:shadow-2xl transition transform hover:scale-105 overflow-x-auto">
      <h4 class="text-lg font-semibold text-gray-700 mb-5 flex items-center gap-2">
        <i class="fas fa-building text-green-500"></i> Block Wise Complaints
      </h4>
      <table class="w-full min-w-[500px] border border-gray-200 rounded-lg">
        <thead>
          <tr class="bg-green-50 text-gray-700 text-sm uppercase">
            <th class="p-2 text-left border">District</th>
            <th class="p-2 text-left border">Block</th>
            <th class="p-2 text-left border">Total</th>
            <th class="p-2 text-left border">Accepted</th>
            <th class="p-2 text-left border">Rejected</th>
            <th class="p-2 text-left border">Solved</th>
          </tr>
        </thead>
        <tbody class="text-gray-600 text-sm">
          {% for item in block_wise_complaints %}
          <tr class="hover:bg-green-50 transition">
            <td class="p-2 border font-medium">{{ item.district }}</td>
            <td class="p-2 border">{{ item.block }}</td>
            <td class="p-2 border font-bold text-green-700">{{ item.total }}</td>
            <td class="p-2 border font-bold text-green-600">{{ item.accepted }}</td>
            <td class="p-2 border font-bold text-red-600">{{ item.rejected }}</td>
            <td class="p-2 border font-bold text-purple-600">{{ item.solved }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="6" class="p-2 text-center text-gray-500">No Data</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Panchayat Wise -->
    <div class="bg-white shadow-xl rounded-2xl p-6 border border-gray-200 hover:shadow-2xl transition transform hover:scale-105 overflow-x-auto">
      <h4 class="text-lg font-semibold text-gray-700 mb-5 flex items-center gap-2">
        <i class="fas fa-users text-purple-500"></i> Panchayat Wise Complaints
      </h4>
      <table class="w-full min-w-[600px] border border-gray-200 rounded-lg">
        <thead>
          <tr class="bg-purple-50 text-gray-700 text-sm uppercase">
            <th class="p-2 text-left border">District</th>
            <th class="p-2 text-left border">Block</th>
            <th class="p-2 text-left border">Panchayat</th>
            <th class="p-2 text-left border">Total</th>
            <th class="p-2 text-left border">Accepted</th>
            <th class="p-2 text-left border">Rejected</th>
            <th class="p-2 text-left border">Solved</th>
          </tr>
        </thead>
        <tbody class="text-gray-600 text-sm">
          {% for item in panchayat_wise_complaints %}
          <tr class="hover:bg-purple-50 transition">
            <td class="p-2 border font-medium">{{ item.district }}</td>
            <td class="p-2 border">{{ item.block }}</td>
            <td class="p-2 border">{{ item.panchayat }}</td>
            <td class="p-2 border font-bold text-purple-700">{{ item.total }}</td>
            <td class="p-2 border font-bold text-green-600">{{ item.accepted }}</td>
            <td class="p-2 border font-bold text-red-600">{{ item.rejected }}</td>
            <td class="p-2 border font-bold text-blue-600">{{ item.solved }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="7" class="p-2 text-center text-gray-500">No Data</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</section>



</div>

{% endblock %}
